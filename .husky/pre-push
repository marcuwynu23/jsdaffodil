#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Get the remote branch being pushed to
remote="$1"
url="$2"

# Check if any tags are being pushed
while read local_ref local_sha remote_ref remote_sha
do
  # Check if this is a tag push
  if [[ "$local_ref" =~ ^refs/tags/ ]]; then
    echo "üîÑ Tag detected! Updating CHANGELOG.md..."
    npm run changelog
    
    # Check if CHANGELOG was modified
    if git diff --quiet CHANGELOG.md; then
      echo "‚úÖ CHANGELOG.md is up to date"
    else
      echo "üìù CHANGELOG.md has been updated"
      echo "‚ö†Ô∏è  Please commit the updated CHANGELOG.md before pushing the tag"
      echo "   Run: git add CHANGELOG.md && git commit -m 'chore: update CHANGELOG.md'"
      exit 1
    fi
  fi
done
